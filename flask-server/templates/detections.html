<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Road Damage Detection Dashboard</title>
    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }
      
      body {
        font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
        background-color: #f5f5f5;
        color: #333;
        line-height: 1.6;
      }
      
      .header {
        background: linear-gradient(135deg, #2196f3, #1976d2);
        color: white;
        padding: 2rem 0;
        text-align: center;
        box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
      }
      
      .header h1 {
        font-size: 2.5rem;
        margin-bottom: 0.5rem;
      }
      
      .header p {
        font-size: 1.1rem;
        opacity: 0.9;
      }
      
      .container {
        max-width: 1200px;
        margin: 0 auto;
        padding: 2rem;
      }
      
      .stats-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
        gap: 1.5rem;
        margin-bottom: 3rem;
      }
      
      .stat-card {
        background: white;
        padding: 2rem;
        border-radius: 12px;
        box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        text-align: center;
        transition: transform 0.2s ease;
      }
      
      .stat-card:hover {
        transform: translateY(-2px);
      }
      
      .stat-number {
        font-size: 3rem;
        font-weight: bold;
        color: #2196f3;
        margin-bottom: 0.5rem;
      }
      
      .stat-label {
        font-size: 1.1rem;
        color: #666;
        font-weight: 500;
      }
      
      .filters {
        background: white;
        padding: 1.5rem;
        border-radius: 12px;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        margin-bottom: 2rem;
        display: flex;
        gap: 1rem;
        align-items: center;
        flex-wrap: wrap;
      }
      
      .filter-item {
        display: flex;
        flex-direction: column;
      }
      
      .filter-item label {
        margin-bottom: 0.5rem;
        font-weight: 500;
        color: #555;
      }
      
      .filter-item select,
      .filter-item input {
        padding: 0.5rem;
        border: 2px solid #e0e0e0;
        border-radius: 6px;
        font-size: 1rem;
      }
      
      .filter-item select:focus,
      .filter-item input:focus {
        outline: none;
        border-color: #2196f3;
      }
      
      .detections-grid {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(400px, 1fr));
        gap: 2rem;
      }
      
      .detection-card {
        background: white;
        border-radius: 12px;
        box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        overflow: hidden;
        transition: transform 0.2s ease, box-shadow 0.2s ease;
      }
      
      .detection-card:hover {
        transform: translateY(-4px);
        box-shadow: 0 8px 25px rgba(0, 0, 0, 0.15);
      }
      
      .detection-image {
        width: 100%;
        height: 250px;
        object-fit: cover;
        cursor: pointer;
      }
      
      .detection-content {
        padding: 1.5rem;
      }
      
      .detection-header {
        display: flex;
        justify-content: between;
        align-items: center;
        margin-bottom: 1rem;
      }
      
      .detection-id {
        font-size: 1.2rem;
        font-weight: bold;
        color: #2196f3;
      }
      
      .detection-date {
        color: #666;
        font-size: 0.9rem;
      }
      
      .damage-chips {
        display: flex;
        flex-wrap: wrap;
        gap: 0.5rem;
        margin-bottom: 1rem;
      }
      
      .damage-chip {
        padding: 0.3rem 0.8rem;
        border-radius: 20px;
        font-size: 0.85rem;
        font-weight: 500;
        color: white;
      }
      
      .damage-longitudinal {
        background-color: #ff9800;
      }
      .damage-transverse {
        background-color: #f44336;
      }
      .damage-alligator {
        background-color: #9c27b0;
      }
      .damage-potholes {
        background-color: #3f51b5;
      }
      
      .location {
        color: #666;
        font-size: 0.9rem;
        margin-top: 0.5rem;
        display: flex;
        flex-direction: column;
        gap: 0.5rem;
      }
      
      .maps-link {
        color: #2196f3;
        text-decoration: none;
        font-weight: 500;
        font-size: 0.85rem;
        padding: 0.3rem 0.6rem;
        background-color: #e3f2fd;
        border-radius: 15px;
        display: inline-block;
        transition: all 0.2s ease;
        width: fit-content;
      }
      
      .maps-link:hover {
        background-color: #2196f3;
        color: white;
        text-decoration: none;
      }
      
      .no-detections {
        text-align: center;
        padding: 4rem 2rem;
        color: #666;
      }
      
      .no-detections h3 {
        margin-bottom: 1rem;
        color: #999;
      }
      
      .refresh-btn {
        background: #2196f3;
        color: white;
        border: none;
        padding: 0.8rem 1.5rem;
        border-radius: 6px;
        font-size: 1rem;
        cursor: pointer;
        transition: background-color 0.2s ease;
      }
      
      .refresh-btn:hover {
        background: #1976d2;
      }
      
      .modal {
        display: none;
        position: fixed;
        z-index: 1000;
        left: 0;
        top: 0;
        width: 100%;
        height: 100%;
        background-color: rgba(0, 0, 0, 0.9);
      }
      
      .modal-content {
        display: block;
        margin: auto;
        max-width: 90%;
        max-height: 90%;
        margin-top: 5%;
      }
      
      .close {
        position: absolute;
        top: 15px;
        right: 35px;
        color: #fff;
        font-size: 40px;
        font-weight: bold;
        cursor: pointer;
      }
      
      .close:hover {
        opacity: 0.7;
      }
      
      @media (max-width: 768px) {
        .container {
          padding: 1rem;
        }
      
        .detections-grid {
          grid-template-columns: 1fr;
        }
      
        .filters {
          flex-direction: column;
          align-items: stretch;
        }
      
        .filter-item {
          width: 100%;
        }
      }
    </style>
  </head>
  <body>
    <div class="header">
      <h1>üõ£Ô∏è Road Damage Detection Dashboard</h1>
      <p>Real-time monitoring and analysis of road infrastructure damage</p>
    </div>

    <div class="container">
      <!-- Statistics -->
      <div class="stats-grid">
        <div class="stat-card">
          <div class="stat-number">{{ stats.total_detections }}</div>
          <div class="stat-label">Total Detections</div>
        </div>
        <div class="stat-card">
          <div class="stat-number">{{ stats.damage_type_distribution.get('Longitudinal Crack', 0) }}</div>
          <div class="stat-label">Longitudinal Cracks</div>
        </div>
        <div class="stat-card">
          <div class="stat-number">{{ stats.damage_type_distribution.get('Transverse Crack', 0) }}</div>
          <div class="stat-label">Transverse Cracks</div>
        </div>
        <div class="stat-card">
          <div class="stat-number">{{ stats.damage_type_distribution.get('Potholes', 0) }}</div>
          <div class="stat-label">Potholes</div>
        </div>
      </div>

      <!-- Filters -->
      <div class="filters">
        <div class="filter-item">
          <label for="damageFilter">Filter by Damage Type:</label>
          <select id="damageFilter">
            <option value="all">All Types</option>
            <option value="Longitudinal Crack">Longitudinal Crack</option>
            <option value="Transverse Crack">Transverse Crack</option>
            <option value="Alligator Crack">Alligator Crack</option>
            <option value="Potholes">Potholes</option>
          </select>
        </div>

        <div class="filter-item">
          <label for="dateFilter">Filter by Date:</label>
          <input type="date" id="dateFilter" />
        </div>

        <button class="refresh-btn" onclick="location.reload()">üîÑ Refresh</button>
      </div>

      <!-- Detections Grid -->
      <div class="detections-grid" id="detectionsGrid">
        {% for detection in detections %}
          <div class="detection-card" data-damage-types="{{ detection.damage_types|join(',') }}" data-date="{{ detection.date }}">
            <img src="/api/image/{{ detection.id }}" alt="Detection {{ detection.id }}" class="detection-image" onclick="openModal(this.src)" loading="lazy" />

            <div class="detection-content">
              <div class="detection-header">
                <span class="detection-id">Detection #{{ detection.id }}</span>
                <span class="detection-date">{{ detection.timestamp }}</span>
              </div>

              <div class="damage-chips">
                {% for damage in detection.detected_damages %}
                  <span class="damage-chip damage-{{ damage.class.lower().replace(' ', '-') }}">{{ damage.class }} ({{ '%.1f'|format(damage.confidence * 100) }}%)</span>
                {% endfor %}
              </div>

              {% if detection.latitude and detection.longitude %}
                <div class="location">
                  üìç {{ '%.6f'|format(detection.latitude) }}, {{ '%.6f'|format(detection.longitude) }}
                  <a href="https://www.google.com/maps?q={{ detection.latitude }},{{ detection.longitude }}" target="_blank" class="maps-link">üó∫Ô∏è Open in Google Maps</a>
                </div>
              {% endif %}
            </div>
          </div>
        {% endfor %}
      </div>

      {% if not detections %}
        <div class="no-detections">
          <h3>No detections found</h3>
          <p>Start using the mobile app to capture and detect road damage!</p>
        </div>
      {% endif %}
    </div>

    <!-- Modal for full-size images -->
    <div id="imageModal" class="modal">
      <span class="close" onclick="closeModal()">&times;</span>
      <img class="modal-content" id="modalImage" />
    </div>

    <script>
      // Filter functionality
      const damageFilter = document.getElementById('damageFilter')
      const dateFilter = document.getElementById('dateFilter')
      const detectionsGrid = document.getElementById('detectionsGrid')
      
      function filterDetections() {
        const selectedDamageType = damageFilter.value
        const selectedDate = dateFilter.value
        const cards = detectionsGrid.querySelectorAll('.detection-card')
      
        cards.forEach((card) => {
          const damageTypes = card.dataset.damageTypes.split(',')
          const cardDate = card.dataset.date
      
          let showCard = true
      
          // Filter by damage type
          if (selectedDamageType !== 'all') {
            showCard = showCard && damageTypes.includes(selectedDamageType)
          }
      
          // Filter by date
          if (selectedDate) {
            showCard = showCard && cardDate === selectedDate
          }
      
          card.style.display = showCard ? 'block' : 'none'
        })
      }
      
      damageFilter.addEventListener('change', filterDetections)
      dateFilter.addEventListener('change', filterDetections)
      
      // Modal functionality
      function openModal(src) {
        const modal = document.getElementById('imageModal')
        const modalImg = document.getElementById('modalImage')
        modal.style.display = 'block'
        modalImg.src = src
      }
      
      function closeModal() {
        document.getElementById('imageModal').style.display = 'none'
      }
      
      // Close modal when clicking outside the image
      window.onclick = function (event) {
        const modal = document.getElementById('imageModal')
        if (event.target === modal) {
          closeModal()
        }
      }
      
      // Close modal with Escape key
      document.addEventListener('keydown', function (event) {
        if (event.key === 'Escape') {
          closeModal()
        }
      })
    </script>
  </body>
</html>
